---
title: "Fruit Model"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Running The Model

To run the model, run the file 'Fruit_model_run_with_my_data' in folder 'Run'. The parameters can be adjusted in the file 'Parameters' in folder 'Run'. The other scripts and functions involved are found in 'Analysis/Functions', 'Data/Data_Producer' and 'Model/Fruit_model'. The R code is uncommented on the GitHub version - for some reason didn't run properly via RMarkdown.

```{r}
# source('~/GitHub/NIAB_Rotation/Fruit_model/Data/Data_Functions.R')# contains functions 'folder_names', 'labeller', 'Data_in_final_form'
# source('~/GitHub/NIAB_Rotation/Fruit_model/Run/Parameters.R')     # needs Data_Functions
# source('~/GitHub/NIAB_Rotation/Fruit_model/Analysis/Functions.R') # contains functions 'image_tester', 'preds', 'multipreds', 'image_predictor'
# source('~/GitHub/NIAB_Rotation/Fruit_model/Data/Data_Producer.R') # slow to run
# source('~/GitHub/NIAB_Rotation/Fruit_model/Model/Fruit_model.R')  # needs parameters   # contains function 'create_fruit_model', 'image_predictor'
```

```{r}
# library(keras)
# library(dplyr)
# library(ggplot2)
# library(tidyr)
```

```{r}
# data comes in from Data_Labeller

############################################
# fit model
# model_name <- "fruit_model_new.h5" # "fruit_model.h5"
# model_my_own <-create_fruit_model(Train_data_reshaped[,,,channel_no,drop = F],Train_labels,Test_data_reshaped[,,,channel_no,drop = F],Test_labels,channels) # drop = F stops R collapsing array to 3 dimensions not 4
# model_my_own %>% summary()
# model_my_own %>% save_model_hdf5(model_name)
# 
# 
# # below model has all fruits
# #new_model <- load_model_hdf5("fruit_model.h5")
# #new_model %>% summary()
# 
# results <- model_my_own %>% evaluate(Test_data_reshaped[165:3622,,,channel_no,drop=F], Test_labels[165:3622])
# results
# 
# results <- model_my_own %>% predict_classes(Test_data_reshaped[1:164,,,channel_no,drop = F]) # drop = F stops R collapsing array to 3 dimensions not 4
# ############################################
# data <- image_tester(internet_path,"Walnut")
# res2 <- model_my_own %>% predict(data)
# preds(res2)
# multipreds(res2,number_probs)

```
